FROM maven:3.9.4-eclipse-temurin-11 as maven-java-node
ENV MAVEN_CONFIG=~/.m2
# installing node 18.16.1 and npm 9.5.1 in docker container
RUN mkdir -p /usr/local/content/node
WORKDIR /usr/local/content/node
ADD https://nodejs.org/dist/v18.16.1/node-v18.16.1-linux-x64.tar.gz .
RUN tar -xzf node-v18.16.1-linux-x64.tar.gz \
    && ln -s /usr/local/content/node/node-v18.16.1-linux-x64/bin/node /usr/local/bin/node \
    && ln -s /usr/local/content/node/node-v18.16.1-linux-x64/bin/npm /usr/local/bin/npm \
    && chown -R root:root /usr/local/content/node \
    && rm -fR node-v18.16.1-linux-x64.tar.gz
# stage for build the code
FROM maven-java-node
RUN mkdir -p /usr/local/content/app
WORKDIR /usr/local/content/app
CMD  mvn clean install -P${profile} && mkdir -p dist && cp -fr target/*.war dist/


